# Nx OxCaml Backend

An experimental high-performance backend for Nx that leverages OxCaml's unboxed types.

## Overview

This backend implements the Nx backend interface using OxCaml's unboxed types for improved performance:

- **Unboxed arithmetic**: Uses `float#`, `int32#`, `int64#` for zero-allocation numeric operations
- **Parallel execution**: Built-in support for parallel operations (currently sequential, Domain support planned)
- **Memory efficiency**: Reduces GC pressure by avoiding boxing/unboxing overhead

## Building

```bash
cd dev/nx-oxcaml
dune pkg lock --root . 
dune build --root . 
```

## Benchmark Results

```
┌──────────────────────────────────┬──────────┬──────────┬─────────┬─────────┬────────────┐
│ Name                             │ Wall/Run │  CPU/Run │ mWd/Run │ Speedup │ vs Fastest │
├──────────────────────────────────┼──────────┼──────────┼─────────┼─────────┼────────────┤
│ Add 500x500 f32 (Nx (C))         │  59.53μs │ 127.40μs │ 462.00w │   0.92x │       109% │
│ Add 500x500 f32 (Nx (OxCaml))    │  85.21μs │ 380.24μs │ 166.00w │   0.64x │       156% │
│ Sub 500x500 f32 (Nx (C))         │  60.19μs │ 129.04μs │ 462.00w │   0.91x │       110% │
│ Sub 500x500 f32 (Nx (OxCaml))    │  91.79μs │ 376.48μs │ 166.00w │   0.59x │       168% │
│ Mul 500x500 f32 (Nx (C))         │  59.16μs │ 126.95μs │ 462.00w │   0.92x │       108% │
│ Mul 500x500 f32 (Nx (OxCaml))    │  87.63μs │ 361.92μs │ 166.00w │   0.62x │       160% │
│ Div 500x500 f32 (Nx (C))         │  57.98μs │ 127.05μs │ 470.00w │   0.94x │       106% │
│ Div 500x500 f32 (Nx (OxCaml))    │  86.43μs │ 374.72μs │ 174.00w │   0.63x │       158% │
│ Mod 500x500 f32 (Nx (C))         │ 452.70μs │   2.69ms │ 462.00w │   0.12x │       829% │
│ Mod 500x500 f32 (Nx (OxCaml))    │ 139.81μs │ 745.57μs │ 166.00w │   0.39x │       256% │
│ Pow 500x500 f32 (Nx (C))         │ 226.96μs │   1.11ms │ 462.00w │   0.24x │       416% │
│ Pow 500x500 f32 (Nx (OxCaml))    │ 147.69μs │ 748.69μs │ 166.00w │   0.37x │       270% │
│ Max 500x500 f32 (Nx (C))         │  59.15μs │ 128.59μs │ 462.00w │   0.92x │       108% │
│ Max 500x500 f32 (Nx (OxCaml))    │ 152.47μs │ 815.79μs │ 166.00w │   0.36x │       279% │
│ Min 500x500 f32 (Nx (C))         │  58.45μs │ 128.44μs │ 462.00w │   0.93x │       107% │
│ Min 500x500 f32 (Nx (OxCaml))    │ 153.69μs │ 817.12μs │ 166.00w │   0.36x │       281% │
│ Neg 500x500 f32 (Nx (C))         │  54.61μs │ 114.52μs │ 251.00w │   1.00x │       100% │
│ Neg 500x500 f32 (Nx (OxCaml))    │  76.38μs │ 300.21μs │ 138.00w │   0.71x │       140% │
│ Abs 500x500 f32 (Nx (C))         │  55.08μs │ 117.05μs │ 251.00w │   0.99x │       101% │
│ Abs 500x500 f32 (Nx (OxCaml))    │  74.43μs │ 296.33μs │ 138.00w │   0.73x │       136% │
│ Sqrt 500x500 f32 (Nx (C))        │  60.71μs │ 141.71μs │ 251.00w │   0.90x │       111% │
│ Sqrt 500x500 f32 (Nx (OxCaml))   │  76.54μs │ 312.74μs │ 138.00w │   0.71x │       140% │
│ Exp 500x500 f32 (Nx (C))         │ 121.68μs │ 513.45μs │ 251.00w │   0.45x │       223% │
│ Exp 500x500 f32 (Nx (OxCaml))    │ 149.44μs │ 736.93μs │ 138.00w │   0.37x │       274% │
│ Log 500x500 f32 (Nx (C))         │ 166.99μs │ 707.51μs │ 251.00w │   0.33x │       306% │
│ Log 500x500 f32 (Nx (OxCaml))    │ 137.78μs │ 645.92μs │ 138.00w │   0.40x │       252% │
│ Sin 500x500 f32 (Nx (C))         │ 210.98μs │   1.01ms │ 251.00w │   0.26x │       386% │
│ Sin 500x500 f32 (Nx (OxCaml))    │ 136.42μs │ 656.99μs │ 138.00w │   0.40x │       250% │
│ Cos 500x500 f32 (Nx (C))         │ 229.18μs │   1.09ms │ 251.00w │   0.24x │       420% │
│ Cos 500x500 f32 (Nx (OxCaml))    │ 121.84μs │ 624.76μs │ 138.00w │   0.45x │       223% │
│ Add 500x500 f64 (Nx (C))         │  65.60μs │ 172.11μs │ 462.00w │   0.83x │       120% │
│ Add 500x500 f64 (Nx (OxCaml))    │  78.10μs │ 320.88μs │ 166.00w │   0.70x │       143% │
│ Sub 500x500 f64 (Nx (C))         │  65.21μs │ 171.01μs │ 462.00w │   0.84x │       119% │
│ Sub 500x500 f64 (Nx (OxCaml))    │  74.92μs │ 322.09μs │ 166.00w │   0.73x │       137% │
│ Mul 500x500 f64 (Nx (C))         │  66.66μs │ 171.40μs │ 462.00w │   0.82x │       122% │
│ Mul 500x500 f64 (Nx (OxCaml))    │  74.49μs │ 305.95μs │ 166.00w │   0.73x │       136% │
│ Div 500x500 f64 (Nx (C))         │  65.29μs │ 172.13μs │ 470.00w │   0.84x │       120% │
│ Div 500x500 f64 (Nx (OxCaml))    │ 180.34μs │ 408.17μs │ 174.00w │   0.30x │       330% │
│ Mod 500x500 f64 (Nx (C))         │ 495.83μs │   2.70ms │ 462.00w │   0.11x │       908% │
│ Mod 500x500 f64 (Nx (OxCaml))    │ 149.15μs │ 731.28μs │ 166.00w │   0.37x │       273% │
│ Pow 500x500 f64 (Nx (C))         │ 414.54μs │   2.31ms │ 462.00w │   0.13x │       759% │
│ Pow 500x500 f64 (Nx (OxCaml))    │ 141.45μs │ 720.36μs │ 166.00w │   0.39x │       259% │
│ Max 500x500 f64 (Nx (C))         │  65.69μs │ 173.75μs │ 462.00w │   0.83x │       120% │
│ Max 500x500 f64 (Nx (OxCaml))    │ 149.79μs │ 784.61μs │ 166.00w │   0.36x │       274% │
│ Min 500x500 f64 (Nx (C))         │  64.01μs │ 168.08μs │ 462.00w │   0.85x │       117% │
│ Min 500x500 f64 (Nx (OxCaml))    │ 148.94μs │ 794.19μs │ 166.00w │   0.37x │       273% │
│ Neg 500x500 f64 (Nx (C))         │  62.09μs │ 154.87μs │ 251.00w │   0.88x │       114% │
│ Neg 500x500 f64 (Nx (OxCaml))    │  69.69μs │ 273.41μs │ 138.00w │   0.78x │       128% │
│ Abs 500x500 f64 (Nx (C))         │  64.46μs │ 153.09μs │ 251.00w │   0.85x │       118% │
│ Abs 500x500 f64 (Nx (OxCaml))    │  70.07μs │ 272.03μs │ 138.00w │   0.78x │       128% │
│ Sqrt 500x500 f64 (Nx (C))        │  68.25μs │ 190.91μs │ 251.00w │   0.80x │       125% │
│ Sqrt 500x500 f64 (Nx (OxCaml))   │  75.00μs │ 309.72μs │ 138.00w │   0.73x │       137% │
│ Exp 500x500 f64 (Nx (C))         │ 160.07μs │ 707.47μs │ 251.00w │   0.34x │       293% │
│ Exp 500x500 f64 (Nx (OxCaml))    │ 168.65μs │ 905.03μs │ 138.00w │   0.32x │       309% │
│ Log 500x500 f64 (Nx (C))         │ 253.34μs │   1.26ms │ 251.00w │   0.22x │       464% │
│ Log 500x500 f64 (Nx (OxCaml))    │ 123.04μs │ 608.18μs │ 138.00w │   0.44x │       225% │
│ Sin 500x500 f64 (Nx (C))         │ 240.97μs │   1.17ms │ 251.00w │   0.23x │       441% │
│ Sin 500x500 f64 (Nx (OxCaml))    │ 104.01μs │ 509.49μs │ 138.00w │   0.52x │       190% │
│ Cos 500x500 f64 (Nx (C))         │ 238.13μs │   1.15ms │ 251.00w │   0.23x │       436% │
│ Cos 500x500 f64 (Nx (OxCaml))    │ 148.27μs │ 776.67μs │ 138.00w │   0.37x │       272% │
│ Add 1000x1000 f32 (Nx (C))       │  79.04μs │ 263.88μs │ 462.00w │   0.69x │       145% │
│ Add 1000x1000 f32 (Nx (OxCaml))  │ 195.31μs │   1.08ms │ 166.00w │   0.28x │       358% │
│ Sub 1000x1000 f32 (Nx (C))       │  81.29μs │ 270.68μs │ 462.00w │   0.67x │       149% │
│ Sub 1000x1000 f32 (Nx (OxCaml))  │ 196.45μs │   1.04ms │ 166.00w │   0.28x │       360% │
│ Mul 1000x1000 f32 (Nx (C))       │  84.64μs │ 254.69μs │ 462.00w │   0.65x │       155% │
│ Mul 1000x1000 f32 (Nx (OxCaml))  │ 212.90μs │   1.09ms │ 166.00w │   0.26x │       390% │
│ Div 1000x1000 f32 (Nx (C))       │  80.72μs │ 273.61μs │ 470.00w │   0.68x │       148% │
│ Div 1000x1000 f32 (Nx (OxCaml))  │ 214.29μs │   1.08ms │ 174.00w │   0.25x │       392% │
│ Mod 1000x1000 f32 (Nx (C))       │   1.88ms │  10.66ms │ 462.00w │   0.03x │      3435% │
│ Mod 1000x1000 f32 (Nx (OxCaml))  │ 456.72μs │   2.67ms │ 166.00w │   0.12x │       836% │
│ Pow 1000x1000 f32 (Nx (C))       │ 757.29μs │   4.36ms │ 462.00w │   0.07x │      1387% │
│ Pow 1000x1000 f32 (Nx (OxCaml))  │ 441.77μs │   2.73ms │ 166.00w │   0.12x │       809% │
│ Max 1000x1000 f32 (Nx (C))       │  80.15μs │ 270.08μs │ 462.00w │   0.68x │       147% │
│ Max 1000x1000 f32 (Nx (OxCaml))  │ 468.88μs │   3.01ms │ 166.00w │   0.12x │       859% │
│ Min 1000x1000 f32 (Nx (C))       │  80.70μs │ 273.47μs │ 462.00w │   0.68x │       148% │
│ Min 1000x1000 f32 (Nx (OxCaml))  │ 477.02μs │   3.01ms │ 166.00w │   0.11x │       874% │
│ Neg 1000x1000 f32 (Nx (C))       │  74.60μs │ 240.45μs │ 251.00w │   0.73x │       137% │
│ Neg 1000x1000 f32 (Nx (OxCaml))  │ 151.91μs │ 774.53μs │ 138.00w │   0.36x │       278% │
│ Abs 1000x1000 f32 (Nx (C))       │  78.36μs │ 236.21μs │ 251.00w │   0.70x │       143% │
│ Abs 1000x1000 f32 (Nx (OxCaml))  │ 151.79μs │ 782.08μs │ 138.00w │   0.36x │       278% │
│ Sqrt 1000x1000 f32 (Nx (C))      │  87.61μs │ 283.82μs │ 251.00w │   0.62x │       160% │
│ Sqrt 1000x1000 f32 (Nx (OxCaml)) │ 162.88μs │ 839.92μs │ 138.00w │   0.34x │       298% │
│ Exp 1000x1000 f32 (Nx (C))       │ 349.52μs │   1.84ms │ 251.00w │   0.16x │       640% │
│ Exp 1000x1000 f32 (Nx (OxCaml))  │ 425.31μs │   2.67ms │ 138.00w │   0.13x │       779% │
│ Log 1000x1000 f32 (Nx (C))       │ 461.32μs │   2.65ms │ 251.00w │   0.12x │       845% │
│ Log 1000x1000 f32 (Nx (OxCaml))  │ 356.83μs │   2.25ms │ 138.00w │   0.15x │       653% │
│ Sin 1000x1000 f32 (Nx (C))       │ 648.83μs │   3.97ms │ 251.00w │   0.08x │      1188% │
│ Sin 1000x1000 f32 (Nx (OxCaml))  │ 355.73μs │   2.25ms │ 138.00w │   0.15x │       651% │
│ Cos 1000x1000 f32 (Nx (C))       │ 673.03μs │   4.18ms │ 251.00w │   0.08x │      1233% │
│ Cos 1000x1000 f32 (Nx (OxCaml))  │ 363.18μs │   2.24ms │ 138.00w │   0.15x │       665% │
│ Add 1000x1000 f64 (Nx (C))       │ 140.20μs │ 664.68μs │ 462.00w │   0.39x │       257% │
│ Add 1000x1000 f64 (Nx (OxCaml))  │ 195.03μs │   1.09ms │ 166.00w │   0.28x │       357% │
│ Sub 1000x1000 f64 (Nx (C))       │ 146.43μs │ 647.36μs │ 462.00w │   0.37x │       268% │
│ Sub 1000x1000 f64 (Nx (OxCaml))  │ 188.60μs │   1.07ms │ 166.00w │   0.29x │       345% │
│ Mul 1000x1000 f64 (Nx (C))       │ 137.60μs │ 605.81μs │ 462.00w │   0.40x │       252% │
│ Mul 1000x1000 f64 (Nx (OxCaml))  │ 186.91μs │   1.07ms │ 166.00w │   0.29x │       342% │
│ Div 1000x1000 f64 (Nx (C))       │ 139.19μs │ 616.65μs │ 470.00w │   0.39x │       255% │
│ Div 1000x1000 f64 (Nx (OxCaml))  │ 187.66μs │   1.12ms │ 174.00w │   0.29x │       344% │
│ Mod 1000x1000 f64 (Nx (C))       │   1.61ms │  10.80ms │ 462.00w │   0.03x │      2941% │
│ Mod 1000x1000 f64 (Nx (OxCaml))  │ 426.31μs │   2.60ms │ 166.00w │   0.13x │       781% │
│ Pow 1000x1000 f64 (Nx (C))       │   1.50ms │   9.31ms │ 462.00w │   0.04x │      2739% │
│ Pow 1000x1000 f64 (Nx (OxCaml))  │ 454.13μs │   2.79ms │ 166.00w │   0.12x │       832% │
│ Max 1000x1000 f64 (Nx (C))       │ 140.40μs │ 660.01μs │ 462.00w │   0.39x │       257% │
│ Max 1000x1000 f64 (Nx (OxCaml))  │ 477.02μs │   2.94ms │ 166.00w │   0.11x │       874% │
│ Min 1000x1000 f64 (Nx (C))       │ 138.64μs │ 648.32μs │ 462.00w │   0.39x │       254% │
│ Min 1000x1000 f64 (Nx (OxCaml))  │ 472.09μs │   2.96ms │ 166.00w │   0.12x │       865% │
│ Neg 1000x1000 f64 (Nx (C))       │ 104.27μs │ 439.82μs │ 251.00w │   0.52x │       191% │
│ Neg 1000x1000 f64 (Nx (OxCaml))  │ 132.97μs │ 698.60μs │ 138.00w │   0.41x │       244% │
│ Abs 1000x1000 f64 (Nx (C))       │ 111.69μs │ 431.78μs │ 251.00w │   0.49x │       205% │
│ Abs 1000x1000 f64 (Nx (OxCaml))  │ 131.62μs │ 675.12μs │ 138.00w │   0.41x │       241% │
│ Sqrt 1000x1000 f64 (Nx (C))      │ 120.30μs │ 512.02μs │ 251.00w │   0.45x │       220% │
│ Sqrt 1000x1000 f64 (Nx (OxCaml)) │ 162.34μs │ 836.86μs │ 138.00w │   0.34x │       297% │
│ Exp 1000x1000 f64 (Nx (C))       │ 489.43μs │   2.72ms │ 251.00w │   0.11x │       896% │
│ Exp 1000x1000 f64 (Nx (OxCaml))  │ 554.98μs │   3.39ms │ 138.00w │   0.10x │      1016% │
│ Log 1000x1000 f64 (Nx (C))       │ 826.21μs │   5.10ms │ 251.00w │   0.07x │      1513% │
│ Log 1000x1000 f64 (Nx (OxCaml))  │ 372.76μs │   2.24ms │ 138.00w │   0.15x │       683% │
│ Sin 1000x1000 f64 (Nx (C))       │ 792.45μs │   4.62ms │ 251.00w │   0.07x │      1451% │
│ Sin 1000x1000 f64 (Nx (OxCaml))  │ 309.53μs │   1.86ms │ 138.00w │   0.18x │       567% │
│ Cos 1000x1000 f64 (Nx (C))       │ 786.72μs │   4.70ms │ 251.00w │   0.07x │      1441% │
│ Cos 1000x1000 f64 (Nx (OxCaml))  │ 476.81μs │   2.96ms │ 138.00w │   0.11x │       873% │
└──────────────────────────────────┴──────────┴──────────┴─────────┴─────────┴────────────┘
```
